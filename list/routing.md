### Linux路由
路由是IP协议中最重要的功能。时网际互连层的功能，由于互联网本质上是一个网状的结构，当数据包传递到IP协议层时，
必然会面临路径选择问题，即数据包从哪个路径传递是最优的，这就是路由的功能。所谓路由(routing),
就是通过互联的网络，把信息从源地址传输到目的地址的`过程`

路由的原理非常复杂，一般情况下，网络中的主机、路由器和交换机都具有路由的功能。这些设备收到
数据包之后，要根据IP数据报的目的地址，决定选择哪个网络接口把数据包发送出去。如果路由器的某个网络
接口与IP数据包的目的主机位于同一个局域网，则则可以直接通过该接口把数据包传送给目的主机；如果目的主机
与路由器不位于同一个局域网中，则路由器会根据目的地来选择另外一台合适的路由器，再从某个网络接口把数据包发送过去。

#### 路由表

路由表是位于主机或者路由器中的一个小型数据库。路由表是数据转发的基础，不管是主机还是路由器，只要与外界交换IP数据包，
平时都要维护着一张路由表，当发送IP数据包时，要根据目的地址和路由表来决定如何发送。

路由表通常包括目标、网络掩码、网关、接口以及跃点数等内容。其中，目标可以是目标主机、子网地址、网络地址或者默认路由。
通常情况下，默认路由的目标为`0.0.0.0`。当所有路由都不匹配的时候，数据包将被转发给默认路由。

网络掩码与目标配合使用，例如，主机路由的掩码为255.255.255.255，默认路由的掩码为0.0.0.0，子网或者网络地址的掩码
位于这两者之间。其中，掩码255.255.255.255表示只有精确匹配的目标才使用此路由；掩码0.0.0.0表示任何目标都可以使用此路由。

网关是数据包需要发送到的下一个路由器的IP地址。接口表示用于接通下一个路由器的网络接口。跃点数表示使用路由到达目标的相对
成本。常用指标为跃点，或者到达目标位置所通过的路由器数目。如果有多个相同目标位置的路由，则跃点数最低的路由为最佳路由。

```shell
#打印输出当前主机路由表
route

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
192.168.23.0    *               255.255.255.0   U     0      0        0 eth1
link-local      *               255.255.0.0     U     1002   0        0 eth1
default         192.168.23.254  0.0.0.0         UG    0      0        0 eth1
```
Destination表示目标，Gateway表示网关，Genmask表示网络掩码，Metric表示跃点数，Iface表示网络接口。

#### 静态路由与动态路由

系统管理员可以通过两种方式配置路由表，分别为静态路由和动态路由。静态路由由系统管理员手工或者通过route命令
对路由表进行配置，它不会随着未来网络结构的改变自动发生变化。动态路由由主机上面的某一进程通过与其他的主机或者
路由器交换路由信息后再对路由表进行自动更新，它会根据网络系统的运行情况而自动调整。

静态路由和动态路由各有自己的优缺点和适用范围。通常情况下，可以吧动态路由作为静态路由的补充，其做法是
当一个数据包在路由器中进行路由查找时，首先将数据包与静态路由条目匹配，如果能匹配其中一条，就按照该静态路由
转发数据包；如果所有的静态路由都不能匹配，则使用动态路由规则来转发。

### Linux配置静态路由

静态路由，简单、高效、可靠，在一般的路由器和主机中，都要使用静态路由。Linux系统除了需要在主机中
配置路由外，还可以配置成路由器，以便为其他主机提供路由服务。

#### 配置网络接口

可通过两种方式来配置网络接口，分别为使用ifconfig命令和直接修改网络接口配置文件

ifconfig命令是一个用来查看、配置、启动或者禁用网络接口的工具，管理员可以使用该命令`临时性`地配置网卡的IP地址、
子网掩码、广播地址以及网关等。
```shell
# ifconfig interface options | address ...

# interface eth0 eth1
# [options] up down netmask broadcast address
ifconfig -a

# 修改主机IP地址为192.168.10.19，子网掩码设置为255.255.255.0，广播地址设置为192.168.10.255
ifconfig eth1 192.168.10.19 netmask 255.255.255.0 broadcast 192.168.10.255

#为某个网络接口设置多个IP地址
ifconfig eth1:0 192.168.10.16 netmask 255.255.255.0 up
```


```shell
# 修改网络接口文件，需要重启网络服务生效
/etc/sysconfig/network-scripts/ifcfg-*

cat /etc/sysconfig/network-scripts/ifcfg-eth1

DEVICE=eth1
TYPE=Ethernet
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=none
IPV6INIT=no
USERCTL=no
IPADDR=192.168.23.213
NETMASK=255.255.255.0
GATEWAY=192.168.23.254
HWADDR=00:50:56:90:d5:44
DNS1=61.139.2.69
DNS2=202.98.96.68
# DEVICE 表示网络接口名称
# BOOTPROTO 表示地址分配方式，即静态地址还是从DHCP服务器动态获取
# ONBOOT表示主机启动的时候是否启动该接口
# IPADDR 表示网络接口的IP地址
# GATEWAY 表示网关地址
# DNS1 DNS2表示DNS服务器地址

# 测试网卡接口IP配置情况
ping 192.168.23.213
```

### route命令
route命令用来查看系统中的路由表信息，以及添加、删除静态路由记录。
```shell
# route add [-net | host] target [netmask mask] [gw Gw] [metric N] [dev]

#添加静态路由
route add -host 58.64.138.213 gw 192.168.10.101
#删除路由
route del -host 58.64.138.213 gw 192.168.10.101
```
